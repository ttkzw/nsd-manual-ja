<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nsd.conf(5) &mdash; NSD 4.3.9 ドキュメント</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/dark.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/light.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="nsd-control(8)" href="nsd-control.html" />
    <link rel="prev" title="nsd-checkzone(8)" href="nsd-checkzone.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/nsd-duotone-white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.3.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zonefile.html">Zonefile example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Running</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../running/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running/using-tsig.html">Using Transaction Signature (TSIG)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running/zone-expiry.html">Zone Expiry of Secondary Zones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running/interfaces.html">Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running/tuning.html">Tuning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manual Pages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nsd.html">nsd(8)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nsd-checkconf.html">nsd-checkconf(8)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nsd-checkzone.html">nsd-checkzone(8)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">nsd.conf(5)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#synopsis">概要</a></li>
<li class="toctree-l2"><a class="reference internal" href="#description">説明</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-format">File Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#server-options">Server Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remote-control">Remote Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pattern-options">Pattern Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zone-options">Zone Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-declarations">Key Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tls-auth-declarations">TLS Auth Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dnstap-logging-options">DNSTAP Logging Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nsd-configuration-for-bind9-hackers">NSD Configuration for BIND9 Hackers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#slave-zones">Slave zones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#master-zones">Master zones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#files">Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bugs">Bugs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nsd-control.html">nsd-control(8)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/configure-options.html">Configure Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/log-diagnosis.html">Diagnosing NSD Log Entries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/grammar.html">Grammar for DNS Zone Files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NSD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">nsd.conf(5)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/manpages/nsd.conf.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nsd-conf-5">
<h1>nsd.conf(5)<a class="headerlink" href="#nsd-conf-5" title="この見出しへのパーマリンク">¶</a></h1>
<section id="synopsis">
<h2>概要<a class="headerlink" href="#synopsis" title="この見出しへのパーマリンク">¶</a></h2>
<p><strong class="command">nsd.conf</strong></p>
</section>
<section id="description">
<h2>説明<a class="headerlink" href="#description" title="この見出しへのパーマリンク">¶</a></h2>
<p><strong class="command">Nsd.conf</strong> is used to configure <em class="manpage"><a class="manpage reference external" href="nsd.html">nsd(8)</a></em>. The file format has
attributes and values. Some attributes have attributes inside them. The notation
is: <code class="docutils literal notranslate"><span class="pre">attribute:</span> <span class="pre">value</span></code>.</p>
<p>Comments start with <code class="docutils literal notranslate"><span class="pre">#</span></code> and last to the end of line. Empty lines are ignored
as is whitespace at the beginning of a line. Quotes can be used,
for names with spaces, eg. &quot;file name.zone&quot;.</p>
<p><strong class="command">Nsd.conf</strong> specifies options for the nsd server, zone files, primaries
and secondaries.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="この見出しへのパーマリンク">¶</a></h2>
<p>An example of a short nsd.conf file is below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Example.com nsd.conf file
# This is a comment.

server:
        server-count: 1 # use this number of cpu cores
        database: &quot;&quot;  # or use &quot;/var/db/nsd/nsd.db&quot;
        zonelistfile: &quot;/var/db/nsd/zone.list&quot;
        username: nsd
        logfile: &quot;/var/log/nsd.log&quot;
        pidfile: &quot;/var/run/nsd.pid&quot;
        xfrdfile: &quot;/var/db/nsd/xfrd.state&quot;

zone:
        name: example.com
        zonefile: /etc/nsd/example.com.zone

zone:
        # this server is master, 192.0.2.1 is the secondary.
        name: masterzone.com
        zonefile: /etc/nsd/masterzone.com.zone
        notify: 192.0.2.1 NOKEY
        provide-xfr: 192.0.2.1 NOKEY

zone:
        # this server is secondary, 192.0.2.2 is master.
        name: secondzone.com
        zonefile: /etc/nsd/secondzone.com.zone
        allow-notify: 192.0.2.2 NOKEY
        request-xfr: 192.0.2.2 NOKEY
</pre></div>
</div>
<p>Then, use <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-HUP</span></code> to reload changes from master zone files. And use <code class="docutils literal notranslate"><span class="pre">kill</span>
<span class="pre">-TERM</span></code> to stop the server.</p>
</section>
<section id="file-format">
<h2>File Format<a class="headerlink" href="#file-format" title="この見出しへのパーマリンク">¶</a></h2>
<p>There  must be whitespace between keywords. Attribute keywords end with a colon
<code class="docutils literal notranslate"><span class="pre">':'</span></code>. An attribute is followed by its containing attributes, or a value.</p>
<p>At the top  level only <strong>server:</strong>, <strong>key:</strong>, <strong>pattern:</strong>, <strong>zone:</strong>,
<strong>tls-auth:</strong>, and <strong>remote-control:</strong> are allowed. These are followed by their
attributes or a new top-level keyword. The <strong>zone:</strong> attribute is followed by
zone options. The <strong>server:</strong> attribute is followed by global options for the
NSD server. A <strong>key:</strong> attribute is used to define keys for authentication. The
<strong>pattern:</strong> attribute is followed by the zone options for zones  that use the
pattern. A <strong>tls-auth:</strong> attribute is used to define credentials for
authenticating an outgoing TLS connection used for XFR-over-TLS.</p>
<p>Files can be included using the <strong>include:</strong> directive. It can appear anywhere,
and takes a single filename as an argument. Processing continues as if the text
from the included file was copied into the config file at that point. If a
chroot is used an absolute filename is needed (with the chroot prepended), so
that the include can be  parsed  before and after application of the chroot (and
the knowledge of what that chroot is).  You can use <code class="docutils literal notranslate"><span class="pre">'*'</span></code> to include a
wildcard match of files,  e.g. <code class="file docutils literal notranslate"><span class="pre">foo/nsd.d/*.conf</span></code>. Also  <code class="docutils literal notranslate"><span class="pre">'?'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'{}'</span></code>, <code class="docutils literal notranslate"><span class="pre">'[]'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'~'</span></code> work, see <em>glob(7)</em>. If no files match the
pattern, this is not an error.</p>
<section id="server-options">
<h3>Server Options<a class="headerlink" href="#server-options" title="この見出しへのパーマリンク">¶</a></h3>
<p>The global options (if not overridden from  the  NSD  commandline) are
taken from the <strong>server:</strong> clause. There may only be one <strong>server:</strong> clause.</p>
<dl>
<dt>ip-address: &lt;ip4 or ip6&gt;[&#64;port] [servers] [bindtodevice] [setfib]</dt><dd><p>NSD  will  bind  to the listed ip-address. Can be given multiple times
to bind multiple ip-addresses. Optionally, a port number can be given.
If none are given NSD listens to the wildcard interface. Same as
commandline option <a class="reference internal" href="nsd.html#cmdoption-a"><code class="xref std std-option docutils literal notranslate"><span class="pre">-a</span></code></a>.</p>
<p>To limit which NSD server(s)  listen  on  the  given  interface, specify
one or more  servers separated by whitespace after &lt;ip&gt;[&#64;port].
Ranges can be used as a shorthand to specify multiple consecutive
servers. By default every server will listen.</p>
<p>If an interface name is used instead of ip4 or ip6, the list of IP
addresses associated with that interface is picked up and used at server
start.</p>
<p>For servers with multiple IP addresses that can be used to send traffic
to the internet, list them one by one, or the source address of replies
could be wrong. This is because if the udp socket associates a source
address of <code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code> then the kernel picks an ip-address with which to
send to the internet, and it picks the wrong one. Typically needed for
anycast instances. Use ip-transparent to be able to list addresses that
turn on later (typical for certain load-balancing).</p>
</dd>
<dt>interface: &lt;ip4 or ip6&gt;[&#64;port] [servers] [bindtodevice] [setfib]</dt><dd><p>Same as ip-address (for ease of compatibility with unbound.conf).</p>
</dd>
<dt>ip-transparent: &lt;yes or no&gt;</dt><dd><p>Allows NSD to bind to non local addresses. This is useful to have NSD
listen to IP addresses that are not (yet) added to the network
interface, so that it can answer immediately when the address is added.
Default is no.</p>
</dd>
<dt>ip-freebind: &lt;yes or no&gt;</dt><dd><p>Set the IP_FREEBIND option to bind to nonlocal addresses and interfaces
that are down. Similar to ip-transparent. Default is no.</p>
</dd>
<dt>reuseport: &lt;yes or no&gt;</dt><dd><p>Use the SO_REUSEPORT socket option, and create file descriptors for
every server in the server-count. This improves performance of the
network stack. Only really useful if you also configure a server-count
higher than 1 (such as, equal to the number of cpus). The default is no.
It works on Linux, but does not work on FreeBSD, and likely does not
work on other systems.</p>
</dd>
<dt>send-buffer-size: &lt;number&gt;</dt><dd><p>Set the send buffer size for query-servicing sockets. Set to 0 to use
the default settings.</p>
</dd>
<dt>receive-buffer-size: &lt;number&gt;</dt><dd><p>Set the receive buffer size for query-servicing sockets. Set to 0 to use
the default settings.</p>
</dd>
<dt>debug-mode: &lt;yes or no&gt;</dt><dd><p>Turns on debugging mode for nsd, does not fork a daemon process. Default
is no. Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-d"><code class="xref std std-option docutils literal notranslate"><span class="pre">-d</span></code></a>. If set to yes it does
not fork and stays in the foreground, which can be helpful for
commandline debugging, but is also used by certain server supervisor
processes to ascertain that the server is running.</p>
</dd>
<dt>do-ip4: &lt;yes or no&gt;</dt><dd><p>If yes, NSD listens to IPv4 connections. Default yes.</p>
</dd>
<dt>do-ip6: &lt;yes or no&gt;</dt><dd><p>If yes, NSD listens to IPv6 connections. Default yes.</p>
</dd>
<dt>database: &lt;filename&gt;</dt><dd><p>By default '/var/db/nsd/nsd.db' is used. The specified file is used to
store the compiled zone information. Same as commandline option
<a class="reference internal" href="nsd.html#cmdoption-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">-f</span></code></a>. If set to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> then no database is used. This uses less
memory but zone updates are not (immediately) spooled to disk.</p>
</dd>
<dt>zonelistfile: &lt;filename&gt;</dt><dd><p>By default <code class="file docutils literal notranslate"><span class="pre">/var/db/nsd/zone.list</span></code> is used. The specified file is
used to store the dynamically added list of zones. The list is written
to by NSD to add and delete zones. It is a text file with a zone-name
and pattern-name on each line. This file is used for the nsd-control
addzone and delzone commands.</p>
</dd>
<dt>identity: &lt;string&gt;</dt><dd><p>Returns the specified identity when asked for <code class="docutils literal notranslate"><span class="pre">CH</span> <span class="pre">TXT</span> <span class="pre">ID.SERVER</span></code>.
Default is the name as returned by <em>gethostname(3)</em>. Same as commandline
option <a class="reference internal" href="nsd.html#cmdoption-i"><code class="xref std std-option docutils literal notranslate"><span class="pre">-i</span></code></a>. See hide-identity to set the server to not respond
to such queries.</p>
</dd>
<dt>version: &lt;string&gt;</dt><dd><p>Returns the specified version string when asked for <code class="docutils literal notranslate"><span class="pre">CH</span> <span class="pre">TXT</span>
<span class="pre">version.server</span></code>, and <code class="docutils literal notranslate"><span class="pre">version.bind</span></code> queries. Default is the compiled
package version. See hide-version to set the server to not respond to
such queries.</p>
</dd>
<dt>nsid: &lt;string&gt;</dt><dd><p>Add the specified nsid to the EDNS section of the answer when queried
with an NSID EDNS enabled packet. As a sequence of hex characters or
with ascii_ prefix and then an ascii string. Same as commandline option
<a class="reference internal" href="nsd.html#cmdoption-I"><code class="xref std std-option docutils literal notranslate"><span class="pre">-I</span></code></a>.</p>
</dd>
<dt>logfile: &lt;filename&gt;</dt><dd><p>Log messages to the logfile. The default is to log to stderr and syslog
(with facility LOG_DAEMON). Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">-l</span></code></a>.</p>
</dd>
<dt>log-only-syslog: &lt;yes or no&gt;</dt><dd><p>Log messages only to syslog. Useful with systemd so that print to stderr
does not cause duplicate log strings in journald. Before syslog has been
opened, the server uses stderr. Stderr is also used if syslog is not
available. Default is no.</p>
</dd>
<dt>server-count: &lt;number&gt;</dt><dd><p>Start this many NSD servers. Default is 1. Same as commandline option
<a class="reference internal" href="nsd.html#cmdoption-N"><code class="xref std std-option docutils literal notranslate"><span class="pre">-N</span></code></a>.</p>
</dd>
<dt>cpu-affinity: &lt;number&gt; &lt;number&gt; ...</dt><dd><p>Overall CPU affinity for NSD server(s). Default is no affinity.</p>
</dd>
<dt>server-N-cpu-affinity: &lt;number&gt;</dt><dd><p>Bind NSD server specified by N to a specific core. Default is to have
affinity set to every core specified in cpu-affinity. This setting only
takes effect if cpu-affinity is enabled.</p>
</dd>
<dt>xfrd-cpu-affinity: &lt;number&gt;</dt><dd><p>Bind xfrd to a specific core. Default is to have affinity set to every
core specified in cpu-affinity. This setting only takes effect if
cpu-affinity is enabled.</p>
</dd>
<dt>tcp-count: &lt;number&gt;</dt><dd><p>The maximum number of concurrent, active TCP connections by each server.
Default is 100. Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-0"><code class="xref std std-option docutils literal notranslate"><span class="pre">-n</span></code></a>.</p>
</dd>
<dt>tcp-reject-overflow: &lt;yes or no&gt;</dt><dd><p>If set to yes, TCP connections made beyond the maximum set by tcp-count
will be dropped immediately (accepted and closed). Default is no.</p>
</dd>
<dt>tcp-query-count: &lt;number&gt;</dt><dd><p>The maximum number of queries served on a single TCP connection. Default
is 0, meaning there is no maximum.</p>
</dd>
<dt>tcp-timeout: &lt;number&gt;</dt><dd><p>Overrides the default TCP timeout. This also affects zone transfers
over TCP. The default is 120 seconds.</p>
</dd>
<dt>tcp-mss: &lt;number&gt;</dt><dd><p>Maximum segment size (MSS) of TCP socket on which the server responds
to queries. Value lower than common MSS on Ethernet (1220 for example)
will address path MTU problem. Note that not all platform supports
socket option to set MSS (TCP_MAXSEG). Default is system default MSS
determined by interface MTU and negotiation between server and client.</p>
</dd>
<dt>outgoing-tcp-mss: &lt;number&gt;</dt><dd><p>Maximum segment size (MSS) of TCP socket for outgoing XFR request to
other namesevers. Value lower than common MSS on Ethernet (1220 for
example) will address path MTU problem. Note that not all platform
supports socket option to set MSS (TCP_MAXSEG). Default is system
default MSS determined by interface MTU and negotiation between NSD and
other servers.</p>
</dd>
<dt>ipv4-edns-size: &lt;number&gt;</dt><dd><p>Preferred EDNS buffer size for IPv4. Default 1232.</p>
</dd>
<dt>ipv6-edns-size: &lt;number&gt;</dt><dd><p>Preferred EDNS buffer size for IPv6. Default 1232.</p>
</dd>
<dt>pidfile: &lt;filename&gt;</dt><dd><p>Use the pid file instead of the platform specific default, usually
<code class="file docutils literal notranslate"><span class="pre">/var/run/nsd.pid</span></code>. Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-P"><code class="xref std std-option docutils literal notranslate"><span class="pre">-P</span></code></a>. With
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> there is no pidfile, for some startup management setups, where a
pidfile is not useful to have.</p>
</dd>
<dt>port: &lt;number&gt;</dt><dd><p>Answer queries on the specified port. Default is 53. Same as commandline
option <a class="reference internal" href="nsd.html#cmdoption-1"><code class="xref std std-option docutils literal notranslate"><span class="pre">-p</span></code></a>.</p>
</dd>
<dt>statistics: &lt;number&gt;</dt><dd><p>If not present no statistics are dumped. Statistics are produced every
number seconds. Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-s"><code class="xref std std-option docutils literal notranslate"><span class="pre">-s</span></code></a>.</p>
</dd>
<dt>chroot: &lt;directory&gt;</dt><dd><p>NSD will chroot on startup to the specified directory. Note that if
elsewhere in the configuration you specify an absolute pathname to a
file inside the chroot, you have to prepend the chroot path. That way,
you can switch the chroot option on and off without having to modify
anything else in the configuration. Set the value to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (the empty
string) to disable the chroot. By default <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> is used. Same as
commandline option <a class="reference internal" href="nsd.html#cmdoption-t"><code class="xref std std-option docutils literal notranslate"><span class="pre">-t</span></code></a>.</p>
</dd>
<dt>username: &lt;username&gt;</dt><dd><p>After binding the socket, drop user privileges and assume the username.
Can be username, id or id.gid. Same as commandline option <a class="reference internal" href="nsd.html#cmdoption-u"><code class="xref std std-option docutils literal notranslate"><span class="pre">-u</span></code></a>.</p>
</dd>
<dt>zonesdir: &lt;directory&gt;</dt><dd><p>Change the working directory to the specified directory before accessing
zone files. Also, NSD will access <strong>database</strong>, <strong>zonelist-file</strong>,
<strong>logfile</strong>, <strong>pidfile</strong>, <strong>xfrdfile</strong>, <strong>xfrdir</strong>, <strong>server-key-file</strong>,
<strong>server-cert-file</strong>, <strong>control-key-file</strong> and <strong>control-cert-file</strong>
relative to this directory. Set the value to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (the empty string)
to disable the change of working directory. By default
<code class="file docutils literal notranslate"><span class="pre">&quot;/etc/nsd&quot;</span></code> is used.</p>
</dd>
<dt>difffile: &lt;filename&gt;</dt><dd><p>Ignored, for compatibility with NSD3 config files.</p>
</dd>
<dt>xfrdfile: &lt;filename&gt;</dt><dd><p>The soa timeout and zone transfer daemon in NSD will save its state to
this file. State is read back after a restart. The state file can be
deleted without too much harm, but timestamps of zones will be gone. If
it is configured as <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, the state file is not used, all slave zones
are checked for updates upon startup. For more details see the section
on zone expiry behavior of NSD. Default is
<code class="file docutils literal notranslate"><span class="pre">/var/db/nsd/xfrd.state</span></code>.</p>
</dd>
<dt>xfrdir: &lt;directory&gt;</dt><dd><p>The zone transfers are stored here before they are processed. A
directory is created here that is removed when NSD exits. Default is
<code class="file docutils literal notranslate"><span class="pre">/tmp</span></code>.</p>
</dd>
<dt>xfrd-reload-timeout: &lt;number&gt;</dt><dd><p>If this value is -1, xfrd will not trigger a reload after a zone
transfer. If positive xfrd will trigger a reload after a zone transfer,
then it will wait for the number of seconds before it will trigger a new
reload. Setting this value throttles the reloads to once per the number
of seconds. The default is 1 second.</p>
</dd>
<dt>verbosity: &lt;level&gt;</dt><dd><p>This value specifies the verbosity level for (non-debug) logging.
Default is 0. 1 gives more information about incoming notifies and
zone transfers. 2 lists soft warnings that are encountered. 3 prints
more information.</p>
<p>Verbosity 0 will print warnings and errors, and other events that are
important to keep NSD running.</p>
<p>Verbosity 1 prints additionally messages of interest. Successful
notifies, successful incoming zone transfer (the zone is updated),
failed incoming zone transfers or the inability to process zone updates.</p>
<p>Verbosity 2 prints additionally soft errors, like connection resets
over TCP. And notify refusal, and axfr request refusals.</p>
</dd>
<dt>hide-version: &lt;yes or no&gt;</dt><dd><p>Prevent NSD from replying with the version string on CHAOS class
queries. Default is no.</p>
</dd>
<dt>hide-identity: &lt;yes or no&gt;</dt><dd><p>Prevent NSD from replying with the identity string on CHAOS class
queries. Default is no.</p>
</dd>
<dt>drop-updates: &lt;yes or no&gt;</dt><dd><p>If set to yes, drop received packets with the UPDATE opcode. Default is
no.</p>
</dd>
<dt>use-systemd: &lt;yes or no&gt;</dt><dd><p>This option is deprecated and ignored. If compiled with libsystemd,
NSD signals readiness to systemd and use of the option is not necessary.</p>
</dd>
<dt>log-time-ascii: &lt;yes or no&gt;</dt><dd><p>Log time in ascii, if &quot;no&quot; then in seconds epoch. Default is yes. This
chooses the format when logging to file. The print- out via syslog has a
timestamp formatted by syslog.</p>
</dd>
<dt>round-robin: &lt;yes or no&gt;</dt><dd><p>Enable round robin rotation of records in the answer. This changes the
order of records in the answer and this may balance load across them.
The default is no.</p>
</dd>
<dt>minimal-responses: &lt;yes or no&gt;</dt><dd><p>Enable minimal responses for smaller answers. This makes pack- ets
smaller. Extra data is only added for referrals, when it is really
necessary. This is different from the --enable-minimal-responses
configure time option, that reduces packets, but ex- actly to the
fragmentation length, the nsd.conf option reduces packets as small as
possible. The default is no.</p>
</dd>
<dt>confine-to-zone: &lt;yes or no&gt;</dt><dd><p>If set to yes, additional information will not be added to the response
if the apex zone of the additional information does not match the apex
zone of the initial query (E.G. CNAME resolution). Default is no.</p>
</dd>
<dt>refuse-any: &lt;yes or no&gt;</dt><dd><p>Refuse queries of type ANY. This is useful to stop query floods trying
to get large responses. Note that rrl ratelimiting also has type ANY as
a ratelimiting type. It sends truncation in response to UDP type ANY
queries, and it allows TCP type ANY queries like normal. The default is
no.</p>
</dd>
<dt>zonefiles-check: &lt;yes or no&gt;</dt><dd><p>Make NSD check the mtime of zone files on start and sighup. If you
disable it it starts faster (less disk activity in case of a lot of
zones). The default is yes. The nsd-control reload command reloads
zone files regardless of this option.</p>
</dd>
<dt>zonefiles-write: &lt;seconds&gt;</dt><dd><p>Write changed secondary zones to their zonefile every N seconds. If the
zone (pattern) configuration has <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> zonefile, it is not written. Zones
that have received zone transfer updates are written to their zonefile.
Default is 0 (disabled) when there is a database, and 3600 (1 hour) when
database is <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>. The database also commits zone transfer contents. You
can configure it away from the default by putting the config statement
for zone-files-write: after the database: statement in the config file.</p>
</dd>
<dt>rrl-size: &lt;numbuckets&gt;</dt><dd><p>This option gives the size of the hashtable. Default 1000000. More
buckets use more memory, and reduce the chance of hash collisions.</p>
</dd>
<dt>rrl-ratelimit: &lt;qps&gt;</dt><dd><p>The max qps allowed (from one query source). Default is on (with a
suggested 200 qps). If set to 0 then it is disabled (unlimited rate),
also set the whitelist-ratelimit to 0 to disable rate-limit processing.
If you set verbosity to 2 the blocked and unblocked subnets are
logged. Blocked queries are blocked and some receive TCP fallback
replies. Once the rate limit is reached, NSD begins dropping responses.
However, one in every &quot;rrl-slip&quot; number of responses is allowed, with
the TC bit set. If slip is set to 2, the outgoing response rate will be
halved. If it's set to 3, the outgoing response rate will be one-third,
and so on. If you set rrl-slip to 10, traffic is reduced to 1/10th.
Ratelimit options rrl-ratelimit, rrl-size and rrl-whitelist-ratelimit
are updated when nsd-control reconfig is done (also the zone-specific
ratelimit options are updated).</p>
</dd>
<dt>rrl-slip: &lt;numpackets&gt;</dt><dd><p>This option controls the number of packets discarded before we send back
a SLIP response (a response with &quot;truncated&quot; bit set to one). 0 disables
the sending of SLIP packets, 1 means every query will get a SLIP
response. Default is 2, cuts traffic in half and legit users have a fair
chance to get a +TC response.</p>
</dd>
<dt>rrl-ipv4-prefix-length: &lt;subnet&gt;</dt><dd><p>IPv4 prefix length. Addresses are grouped by netblock. Default 24.</p>
</dd>
<dt>rrl-ipv6-prefix-length: &lt;subnet&gt;</dt><dd><p>IPv6 prefix length. Addresses are grouped by netblock. Default 64.</p>
</dd>
<dt>rrl-whitelist-ratelimit: &lt;qps&gt;</dt><dd><p>The max qps for query sorts for a source, which have been whitelisted.
Default on (with a suggested 2000 qps). With the rrl-whitelist option
you can set specific queries to receive this qps limit instead of the
normal limit. With the value 0 the rate is unlimited.</p>
</dd>
<dt>answer-cookie: &lt;yes or no&gt;</dt><dd><p>Enable to answer to requests containig DNS Cookies as specified in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7873.html"><strong>RFC 7873</strong></a>. Default is no.</p>
</dd>
<dt>cookie-secret: &lt;128 bit hex string&gt;</dt><dd><p>Servers in an anycast deployment need to be able to verify each other's
DNS Server Cookies. For this they need to share the secret used to
construct and verify the DNS Cookies. Default is a 128 bits random
secret generated at startup time. This option is ignored if a
<strong>cookie-secret-file</strong> is present. In that case the secrets from that
file are used in DNS Cookie calculations.</p>
</dd>
<dt>cookie-secret-file: &lt;filename&gt;</dt><dd><p>File from which the secrets are read used in DNS Cookie calculations.
When this file exists, the secrets in this file are used and the secret
specified by the <strong>cookie-secret</strong> option is ignored. Default is
<code class="file docutils literal notranslate"><span class="pre">/etc/nsd/nsd_cookiesecrets.txt</span></code></p>
<p>The content of this file must be manipulated with the
<strong>add_cookie_secret</strong>, <strong>drop_cookie_secret</strong> and
<strong>activate_cookie_secret</strong> commands to the <em class="manpage"><a class="manpage reference external" href="nsd-control.html">nsd-control(8)</a></em>
tool. Please see that manpage how to perform a safe cookie secret
rollover.</p>
</dd>
<dt>tls-service-key: &lt;filename&gt;</dt><dd><p>If enabled, the server provides TLS service on TCP sockets with the TLS
service port number. The port number (853) is configured with tls-port.
To turn it on, create an interface: option line in config with &#64;port
appended to the IP-address. This creates the extra socket on which the
DNS over TLS service is provided.</p>
<p>The file is the private key for the TLS session. The public certificate
is in the tls-service-pem file. Default is <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, turned off. Requires
a restart (a reload is not enough) if changed, because the private key
is read while root permissions are held and before chroot (if any).</p>
</dd>
<dt>tls-service-pem: &lt;filename&gt;</dt><dd><p>The public key certificate pem file for the tls service. Default is
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, turned off.</p>
</dd>
<dt>tls-service-ocsp: &lt;filename&gt;</dt><dd><p>The ocsp pem file for the tls service, for OCSP stapling. Default is
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, turned off. An external process prepares and updates the OCSP
stapling data. Like this,</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>openssl ocsp -no_nonce \
-respout /path/to/ocsp.pem \
-CAfile /path/to/ca_and_any_intermediate.pem \
-issuer /path/to/direct_issuer.pem \
-cert /path/to/cert.pem \
-url &quot;$( openssl x509 -noout -text -in /path/to/cert.pem |
grep &#39;OCSP - URI:&#39; | cut -d: -f2,3 )&quot;
</pre></div>
</div>
</dd>
<dt>tls-port: &lt;number&gt;</dt><dd><p>The port number on which to provide TCP TLS service, default is
853, only interfaces configured with that port number as &#64;number
get DNS over TLS service.</p>
</dd>
<dt>tls-cert-bundle: &lt;filename&gt;</dt><dd><p>If null or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, the default verify locations are used. Set it to the
certificate bundle file, for example
<code class="file docutils literal notranslate"><span class="pre">&quot;/etc/pki/tls/certs/ca-bundle.crt&quot;</span></code>. These certificates are used
for authenticating Transfer over TLS (XoT) connections.</p>
</dd>
</dl>
</section>
<section id="remote-control">
<h3>Remote Control<a class="headerlink" href="#remote-control" title="この見出しへのパーマリンク">¶</a></h3>
<p>The <strong>remote-control:</strong> clause is used to set options for using the
<em class="manpage"><a class="manpage reference external" href="nsd-control.html">nsd-control(8)</a></em> tool to give commands to the running NSD server. It is
disabled by default, and listens for localhost by default. It uses TLS over TCP
where the server and client authenticate to each other with self-signed
certificates. The self-signed certificates can be generated with the
<em>nsd-control-setup</em> tool. The key files are read by NSD before the chroot and
before dropping user permissions, so they can be outside the chroot and readable
by the superuser only.</p>
<dl>
<dt>control-enable: &lt;yes or no&gt;</dt><dd><p>Enable remote control, default is no.</p>
</dd>
<dt>control-interface: &lt;ip4 or ip6 | interface name | absolute path&gt;</dt><dd><p>NSD will bind to the listed addresses to service control requests (on
TCP). Can be given multiple times to bind multiple ip-addresses. Use
0.0.0.0 and ::0 to service the wildcard interface. If none are given
NSD listens to the localhost 127.0.0.1 and ::1 interfaces for control,
if control is enabled with control-enable.</p>
<p>If an interface name is used instead of ip4 or ip6, the list of IP
addresses associated with that interface is picked up and used at server
start.</p>
<p>With an absolute path, a unix local named pipe is used for control.
The file is created with user and group that is configured and access
bits are set to allow members of the group access. Further access can
be controlled by setting permissions on the directory containing the
control socket file. The key and cert files are not used when control is
via the named pipe, because access control is via file and directory
permission.</p>
</dd>
<dt>control-port: &lt;number&gt;</dt><dd><p>The port number for remote control service. 8952 by default.</p>
</dd>
<dt>server-key-file: &lt;filename&gt;</dt><dd><p>Path to the server private key, by default
<code class="file docutils literal notranslate"><span class="pre">/etc/nsd/nsd_server.key</span></code>. This file is generated by the
nsd-control-setup utility. This file is used by the nsd server, but not
by <em>nsd-control</em>.</p>
</dd>
<dt>server-cert-file: &lt;filename&gt;</dt><dd><p>Path to the server self signed certificate, by default
<code class="file docutils literal notranslate"><span class="pre">/etc/nsd/nsd_server.pem</span></code>. This file is generated by the
<em>nsd-control-setup</em> utility. This file is used by the nsd server, and
also by <em>nsd-control</em>.</p>
</dd>
<dt>control-key-file: &lt;filename&gt;</dt><dd><p>Path to the control client private key, by default
<code class="file docutils literal notranslate"><span class="pre">/etc/nsd/nsd_control.key</span></code>. This file is generated by the
<em>nsd-control-setup</em> utility. This file is used by <em>nsd-control</em>.</p>
</dd>
<dt>control-cert-file: &lt;filename&gt;</dt><dd><p>Path to the control client certificate, by default
<code class="file docutils literal notranslate"><span class="pre">/etc/nsd/nsd_control.pem</span></code>. This certificate has to be signed with
the server certificate. This file is generated by the
<em>nsd-control-setup</em> utility. This file is used by <em>nsd-control</em>.</p>
</dd>
</dl>
</section>
<section id="pattern-options">
<h3>Pattern Options<a class="headerlink" href="#pattern-options" title="この見出しへのパーマリンク">¶</a></h3>
<p>The <strong>pattern:</strong> clause is used to denote a set of options to apply to some
zones. The same zone options as for a zone are allowed.</p>
<dl class="simple">
<dt>name: &lt;string&gt;</dt><dd><p>The name of the pattern. This is a (case sensitive) string. The pattern
names that start with &quot;_implicit_&quot; are used internally for zones that
have no pattern (they are defined in <em>nsd.conf</em> directly).</p>
</dd>
<dt>include-pattern: &lt;pattern-name&gt;</dt><dd><p>The options from the given pattern are included at this point in this
pattern. The referenced pattern must be defined above this one.</p>
</dd>
<dt>&lt;zone option&gt;: &lt;value&gt;</dt><dd><p>The zone options such as <strong>zonefile</strong>, <strong>allow-query</strong>,
<strong>allow-notify</strong>, <strong>request-xfr</strong>, <strong>allow-axfr-fallback</strong>, <strong>notify</strong>,
<strong>notify-retry</strong>, <strong>provide-xfr</strong>, <strong>zonestats</strong>, and
<strong>outgoing-interface</strong> can be given. They are applied to the patterns
and zones that include this pattern.</p>
</dd>
</dl>
</section>
<section id="zone-options">
<h3>Zone Options<a class="headerlink" href="#zone-options" title="この見出しへのパーマリンク">¶</a></h3>
<p>For every zone the options need to be specified in one <strong>zone:</strong> clause. The
access control list elements can be given multiple times to add multiple
servers. These elements need to be added explicitly.</p>
<p>For zones that are configured in the <em>nsd.conf</em> config file their settings are
hardcoded (in an implicit pattern for themselves only) and they cannot be
deleted via delzone, but remove them from the config file and repattern.</p>
<dl>
<dt>name: &lt;string&gt;</dt><dd><p>The name of the zone. This is the domain name of the apex of the zone.
May end with a <code class="docutils literal notranslate"><span class="pre">'.'</span></code> (in FQDN notation). For example &quot;example.com&quot;,
&quot;sub.example.net.&quot;. This attribute must be present in each zone.</p>
</dd>
<dt>zonefile: &lt;filename&gt;</dt><dd><p>The file containing the zone information. If this attribute is present
it is used to read and write the zone contents. If the attribute is
absent it prevents writing out of the zone.</p>
<p>The string is processed so that one string can be used (in a pattern)
for a lot of different zones. If the label or character does not exist
the percent-character is replaced with a period for output (i.e. for the
third character in a two letter domain name).</p>
<p><strong>%s</strong> is replaced with the zone name.</p>
<p><strong>%1</strong> is replaced with the first character of the zone name.</p>
<p><strong>%2</strong> is replaced with the second character of the zone name.</p>
<p><strong>%3</strong> is replaced with the third character of the zone name.</p>
<p><strong>%z</strong> is replaced with the toplevel domain name of the zone.</p>
<p><strong>%y</strong> is replaced with the next label under the toplevel domain.</p>
<p><strong>%x</strong> is replaced with the next-next label under the toplevel domain.</p>
</dd>
<dt>allow-query: &lt;ip-spec&gt; &lt;key-name | NOKEY | BLOCKED&gt;</dt><dd><p>Access control list. When at least one <strong>allow-query</strong> option is
specified, then the in the <strong>allow-query</strong> options specified addresses
are are allowed to query the server for the zone. Queries from unlisted
or specifically BLOCKED addresses are discarded. If NOKEY is given no
TSIG signature is required. BLOCKED supersedes other entries, other
entries are scanned for a match in the order of the statements. Without
<strong>allow-query</strong> options, queries are allowed from any IP address without
TSIG key (which is the default).</p>
<p>The ip-spec is either a plain IP address (IPv4 or IPv6), or can be a
subnet of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4/24</span></code>, or masked like
<code class="docutils literal notranslate"><span class="pre">1.2.3.4&amp;255.255.255.0</span></code> or a range of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4-1.2.3.25</span></code>.
Note the ip-spec ranges do not use spaces around the <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>
and <code class="docutils literal notranslate"><span class="pre">-</span></code> symbols.</p>
</dd>
<dt>allow-notify: &lt;ip-spec&gt; &lt;key-name | NOKEY | BLOCKED&gt;</dt><dd><p>Access control list. The listed (primary) address is allowed to send
notifies to this (secondary) server. Notifies from unlisted or
specifically BLOCKED addresses are discarded. If NOKEY is given no TSIG
signature is required. BLOCKED supersedes other entries, other entries
are scanned for a match in the order of the statements.</p>
<p>The ip-spec is either a plain IP address (IPv4 or IPv6), or can be a
subnet of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4/24</span></code>, or masked like
<code class="docutils literal notranslate"><span class="pre">1.2.3.4&amp;255.255.255.0</span></code> or a range of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4-1.2.3.25</span></code>. A
port number can be added using a suffix of &#64;number, for example
<code class="docutils literal notranslate"><span class="pre">1.2.3.4&#64;5300</span></code> or <code class="docutils literal notranslate"><span class="pre">1.2.3.4/24&#64;5300</span></code> for port 5300. Note the ip-spec
ranges do not use spaces around the <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>
symbols.</p>
</dd>
<dt>request-xfr: [AXFR|UDP] &lt;ip-address&gt; &lt;key-name | NOKEY&gt; [tls-auth-name]</dt><dd><p>Access control list. The listed address (the master) is queried for
AXFR/IXFR on update. A port number can be added using a suffix of
&#64;number, for example <code class="docutils literal notranslate"><span class="pre">1.2.3.4&#64;5300</span></code>. The specified key is used during
AXFR/IXFR. If tls-auth-name is included, the specified tls-auth clause
will be used to perform authenticated XFR-over-TLS.</p>
<p>If the AXFR option is given, the server will not be contacted with IXFR
queries but only AXFR requests will be made to the server. This allows
an NSD secondary to have a master server that runs NSD. If the AXFR
option is left out then both IXFR and AXFR requests are made to the
master server.</p>
<p>If the UDP option is given, the secondary will use UDP to trans- mit the
IXFR requests. You should deploy TSIG when allowing UDP transport, to
authenticate notifies and zone transfers. Otherwise, NSD is more
vulnerable for Kaminsky-style attacks. If the UDP option is left out
then IXFR will be transmitted using TCP.</p>
<p>If a tls-auth-name is given then TLS (by default on port 853) will be
used for all zone transfers for the zone. If authentication of the
master based on the specified tls-auth authentication information
fails, the XFR request will not be sent. Support for TLS 1.3 is required
for XFR-over-TLS.</p>
</dd>
<dt>allow-axfr-fallback: &lt;yes or no&gt;</dt><dd><p>This option should be accompanied by request-xfr. It (dis)allows
NSD (as secondary) to fallback to AXFR if the primary name
server does not support IXFR. Default is yes.</p>
</dd>
<dt>size-limit-xfr: &lt;number&gt;</dt><dd><p>This option should be accompanied by request-xfr. It specifies XFR
temporary file size limit. It can be used to stop very large zone
retrieval, that could otherwise use up a lot of memory and disk space.
If this option is 0, unlimited. Default value is 0.</p>
</dd>
<dt>notify: &lt;ip-address&gt; &lt;key-name | NOKEY&gt;</dt><dd><p>Access control list. The listed address (a secondary) is notified of
updates to this zone. A port number can be added using a suffix of
&#64;number, for example <code class="docutils literal notranslate"><span class="pre">1.2.3.4&#64;5300</span></code>. The specified key is used to sign
the notify. Only on secondary configurations will NSD be able to detect
zone updates (as it gets notified itself, or refreshes after a time).</p>
</dd>
<dt>notify-retry: &lt;number&gt;</dt><dd><p>This option should be accompanied by notify. It sets the number of
retries when sending notifies.</p>
</dd>
<dt>provide-xfr: &lt;ip-spec&gt; &lt;key-name | NOKEY | BLOCKED&gt;</dt><dd><p>Access control list. The listed address (a secondary) is allowed to
request AXFR from this server. Zone data will be provided to the
address. The specified key is used during AXFR. For unlisted or BLOCKED
addresses no data is provided, requests are discarded. BLOCKED
supersedes other entries, other entries are scanned for a match in the
order of the statements. NSD provides AXFR for its secondaries, but IXFR
is not implemented (IXFR is implemented for request-xfr, but not for
provide-xfr).</p>
<p>The ip-spec is either a plain IP address (IPv4 or IPv6), or can be a
subnet of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4/24</span></code>, or masked like
<code class="docutils literal notranslate"><span class="pre">1.2.3.4&amp;255.255.255.0</span></code> or a range of the form <code class="docutils literal notranslate"><span class="pre">1.2.3.4-1.2.3.25</span></code>. A
port number can be added using a suffix of &#64;number, for example
<code class="docutils literal notranslate"><span class="pre">1.2.3.4&#64;5300</span></code> or <code class="docutils literal notranslate"><span class="pre">1.2.3.4/24&#64;5300</span></code> for port 5300. Note the ip-spec
ranges do not use spaces around the the <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>
symbols.</p>
</dd>
<dt>outgoing-interface: &lt;ip-address&gt;</dt><dd><p>Access control list. The listed address is used to request AXFR|IXFR (in
case of a secondary) or used to send notifies (in case of a primary).</p>
<p>The ip-address is a plain IP address (IPv4 or IPv6). A port number can
be added using a suffix of &#64;number, for example <code class="docutils literal notranslate"><span class="pre">1.2.3.4&#64;5300</span></code>.</p>
</dd>
<dt>max-refresh-time: &lt;seconds&gt;</dt><dd><p>Limit refresh time for secondary zones. This is the timer which checks
to see if the zone has to be refetched when it expires. Normally the
value from the SOA record is used, but this option restricts that value.</p>
</dd>
<dt>min-refresh-time: &lt;seconds&gt;</dt><dd><p>Limit refresh time for secondary zones.</p>
</dd>
<dt>max-retry-time: &lt;seconds&gt;</dt><dd><p>Limit retry time for secondary zones. This is the timer which retries
after a failed fetch attempt for the zone. Normally the value from the
SOA record is used, followed by an exponential backoff, but this option
restricts that value.</p>
</dd>
<dt>min-retry-time: &lt;seconds&gt;</dt><dd><p>Limit retry time for secondary zones.</p>
</dd>
<dt>min-expire-time: &lt;seconds or refresh+retry+1&gt;</dt><dd><p>Limit expire time for secondary zones. The value can be expressed either
by a number of seconds, or the string &quot;refresh+retry+1&quot;. With the latter
the expire time will be lower bound to the refresh plus the retry value
from the SOA record, plus 1. The refresh and retry values will be
subject to the bounds configured with max-refresh-time,
min-refresh-time, max-retry-time and min-retry-time if given.</p>
</dd>
<dt>zonestats: &lt;name&gt;</dt><dd><p>When compiled with <code class="docutils literal notranslate"><span class="pre">--enable-zone-stats</span></code> NSD can collect statistics
per zone. This name gives the group where statistics are added to. The
groups are output from nsd-control stats and stats_noreset. Default is
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">&quot;%s&quot;</span></code> to use the name of the zone to track its
statistics. If not compiled in, the option can be given but is ignored.</p>
</dd>
<dt>include-pattern: &lt;pattern-name&gt;</dt><dd><p>The options from the given pattern are included at this point. The
referenced pattern must be defined above this zone.</p>
</dd>
<dt>rrl-whitelist: &lt;rrltype&gt;</dt><dd><p>This option causes queries of this rrltype to be whitelisted, for this
zone. They receive the whitelist-ratelimit. You can give multiple lines,
each enables a new rrltype to be whitelisted for the zone. Default has
none whitelisted. The rrl-type is the query classification that the NSD
RRL employs to make different types not interfere with one another. The
types are logged in the loglines when a subnet is blocked (in verbosity
2). The RRL classification types are: nxdomain, error, referral, any,
rrsig, wildcard, nodata, dnskey, positive, all.</p>
</dd>
<dt>multi-master-check: &lt;yes or no&gt;</dt><dd><p>Default no. If enabled, checks all masters for the last version. It uses
the higher version of all the configured masters. Useful if you have
multiple masters that have different version numbers served.</p>
</dd>
</dl>
</section>
<section id="key-declarations">
<h3>Key Declarations<a class="headerlink" href="#key-declarations" title="この見出しへのパーマリンク">¶</a></h3>
<p>The <strong>key:</strong> clause establishes a key for use in access control lists. It has
the following attributes.</p>
<dl class="simple">
<dt>name: &lt;string&gt;</dt><dd><p>The key name. Used to refer to this key in the access control list. The
key name has to be correct for tsig to work. This is because the key
name is output on the wire.</p>
</dd>
<dt>algorithm: &lt;string&gt;</dt><dd><p>Authentication algorithm for this key. Such as hmac-md5, hmac-sha1,
hmac-sha224, hmac-sha256, hmac-sha384 and hmac-sha512. Can also be
abbreviated as 'sha1', 'sha256'. Default is sha256. Algorithms are only
available when they were compiled in (available in the crypto library).</p>
</dd>
<dt>secret: &lt;base64 blob&gt;</dt><dd><p>The base64 encoded shared secret. It is possible to put the <strong>secret:</strong>
declaration (and base64 blob) into a different file, and then to
<strong>include:</strong> that file. In this way the key secret and the rest of the
configuration file, which may have different security policies, can be
split apart. The content of the secret is the agreed base64 secret
content. To make it up, enter a password (its length must be a multiple
of 4 characters, A-Za-z0-9), or use dev-random output through a base64
encode filter.</p>
</dd>
</dl>
</section>
<section id="tls-auth-declarations">
<h3>TLS Auth Declarations<a class="headerlink" href="#tls-auth-declarations" title="この見出しへのパーマリンク">¶</a></h3>
<p>The <strong>tls-auth:</strong> clause establishes authentication attributes to use when
authenticating the far end of an outgoing TLS connection used in access
control lists for XFR-over-TLS. It has the following attributes.</p>
<dl class="simple">
<dt>name: &lt;string&gt;</dt><dd><p>The tls-auth name. Used to refer to this TLS authentication information
in the access control list.</p>
</dd>
<dt>auth-domain-name: &lt;string&gt;</dt><dd><p>The authentication domain name as defined in <span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc8310.html"><strong>RFC 8310</strong></a>.</p>
</dd>
<dt>client-cert: &lt;file name of clientcert.pem&gt;</dt><dd><p>If you want to use mutual TLS authentication, this is where the client
certificates can be configured that NSD uses to connect to the upstream
server to download the zone. The client public key pem cert file can be
configured here. Also configure a private key with client-key.</p>
</dd>
<dt>client-key: &lt;file name of clientkey.key&gt;</dt><dd><p>If you want to use mutual TLS authentication, the private key file can
be configured here for the client authentication.</p>
</dd>
<dt>client-key-pw: &lt;string&gt;</dt><dd><p>If the client-key file uses a password to decrypt the key before it can
be used, then the password can be specified here as a string. It is
possible to include other config files with the include: option, and
this can be used to move that sensitive data to another file, if you
wish.</p>
</dd>
</dl>
</section>
<section id="dnstap-logging-options">
<h3>DNSTAP Logging Options<a class="headerlink" href="#dnstap-logging-options" title="この見出しへのパーマリンク">¶</a></h3>
<p>DNSTAP support, when compiled in, is enabled in the <strong>dnstap:</strong> section. This
starts a collector process that writes the log information to the destination.</p>
<dl class="simple">
<dt>dnstap-enable: &lt;yes or no&gt;</dt><dd><p>If dnstap is enabled. Default no. If yes, it connects to the dnstap
server and if any of the dnstap-log-..-messages options is enabled it
sends logs for those messages to the server.</p>
</dd>
<dt>dnstap-socket-path: &lt;file name&gt;</dt><dd><p>Sets the unix socket file name for connecting to the server that is
listening on that socket. Default is <code class="file docutils literal notranslate"><span class="pre">&quot;/var/run/nsd-dnstap.sock&quot;</span></code>.</p>
</dd>
<dt>dnstap-send-identity: &lt;yes or no&gt;</dt><dd><p>If enabled, the server identity is included in the log messages. Default
is no.</p>
</dd>
<dt>dnstap-send-version: &lt;yes or no&gt;</dt><dd><p>If enabled, the server version if included in the log messages. Default
is no.</p>
</dd>
<dt>dnstap-identity: &lt;string&gt;</dt><dd><p>The identity to send with messages, if <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> the hostname is used.
Default is <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
</dd>
<dt>dnstap-version: &lt;string&gt;</dt><dd><p>The version to send with messages, if <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> the package version is
used. Default is <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
</dd>
<dt>dnstap-log-auth-query-messages: &lt;yes or no&gt;</dt><dd><p>Enable to log auth query messages. Default is no. These are client
queries to NSD.</p>
</dd>
<dt>dnstap-log-auth-response-messages: &lt;yes or no&gt;</dt><dd><p>Enable to log auth response messages. Default is no. These are responses
from NSD to clients.</p>
</dd>
</dl>
</section>
</section>
<section id="nsd-configuration-for-bind9-hackers">
<h2>NSD Configuration for BIND9 Hackers<a class="headerlink" href="#nsd-configuration-for-bind9-hackers" title="この見出しへのパーマリンク">¶</a></h2>
<p>BIND9 is a name server implementation with its own configuration file
format, <em>named.conf(5)</em>. BIND9 types zones as 'Master' or 'Slave'.</p>
<section id="slave-zones">
<h3>Slave zones<a class="headerlink" href="#slave-zones" title="この見出しへのパーマリンク">¶</a></h3>
<p>For a slave zone, the master servers are listed. The master servers are
queried for zone data, and are listened to for update notifications.
In NSD these two properties need to be configured separately, by listing
the master address in allow-notify and request-xfr statements.</p>
<p>In BIND9 you only need to provide allow-notify elements for any extra
sources of notifications (i.e. the operators), NSD needs to have
allow-notify for both masters and operators. BIND9 allows additional
transfer sources, in NSD you list those as request-xfr.</p>
<p>Here is an example of a slave zone in BIND9 syntax.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Config file for example.org options {
    dnssec-enable yes;
};

key tsig.example.org. {
        algorithm hmac-md5;
        secret &quot;aaaaaabbbbbbccccccdddddd&quot;;
};

server 162.0.4.49 {
        keys { tsig.example.org. ; };
};

zone &quot;example.org&quot; {
        type slave;
        file &quot;secondary/example.org.signed&quot;;
        masters { 162.0.4.49; };
};
</pre></div>
</div>
<p>For NSD, DNSSEC is enabled automatically for zones that are signed. The
<strong>dnssec-enable</strong> statement in the options clause is not needed. In NSD keys are
associated with an IP address in the access control list statement, therefore
the <strong>server{}</strong> statement is not needed. Below is the same example in an NSD
config file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Config file for example.org
key:
        name: tsig.example.org.
        algorithm: hmac-md5
        secret: &quot;aaaaaabbbbbbccccccdddddd&quot;

zone:
        name: &quot;example.org&quot;
        zonefile: &quot;secondary/example.org.signed&quot;
        # the master is allowed to notify and will provide zone data.
        allow-notify: 162.0.4.49 NOKEY
        request-xfr: 162.0.4.49 tsig.example.org.
</pre></div>
</div>
<p>Notice that the master is listed twice, once to allow it to send notifies to
this slave server and once to tell the slave server where to look for updates
zone data. More allow-notify and request-xfr lines can be added to specify more
masters.</p>
<p>It is possible to specify extra allow-notify lines for addresses that are also
allowed to send notifications to this slave server.</p>
</section>
<section id="master-zones">
<h3>Master zones<a class="headerlink" href="#master-zones" title="この見出しへのパーマリンク">¶</a></h3>
<p>For a master zone in BIND9, the slave servers are listed. These slave servers
are sent notifications of updated and are allowed to request transfer of the
zone data. In NSD these two properties need to be configured separately.</p>
<p>Here is an example of a master zone in BIND9 syntax.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>zone &quot;example.nl&quot; {
        type master;
        file &quot;example.nl&quot;;
};

In NSD syntax this becomes:

zone:
        name: &quot;example.nl&quot;
        zonefile: &quot;example.nl&quot;
        # allow anybody to request xfr.
        provide-xfr: 0.0.0.0/0 NOKEY
        provide-xfr: ::0/0 NOKEY

        # to list a slave server you would in general give
        # provide-xfr: 1.2.3.4 tsig-key.name.
        # notify: 1.2.3.4 NOKEY
</pre></div>
</div>
</section>
<section id="other">
<h3>Other<a class="headerlink" href="#other" title="この見出しへのパーマリンク">¶</a></h3>
<p>NSD is an authoritative only DNS server. This means that it is meant as a
primary or secondary server for zones, providing DNS data to DNS resolvers and
caches. BIND9 can function as an authoritative DNS server, the configuration
options for that are compared with those for NSD in this section. However, BIND9
can also function as a resolver or cache. The configuration options that BIND9
has for the resolver or caching thus have no equivalents for NSD.</p>
</section>
</section>
<section id="files">
<h2>Files<a class="headerlink" href="#files" title="この見出しへのパーマリンク">¶</a></h2>
<dl class="simple">
<dt>/var/db/nsd/nsd.db</dt><dd><p>default <strong class="command">NSD</strong> database</p>
</dd>
<dt>/etc/nsd/nsd.conf</dt><dd><p>default <strong class="command">NSD</strong> configuration file</p>
</dd>
</dl>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="この見出しへのパーマリンク">¶</a></h2>
<p><em class="manpage"><a class="manpage reference external" href="nsd.html">nsd(8)</a></em>, <em class="manpage"><a class="manpage reference external" href="nsd-checkconf.html">nsd-checkconf(8)</a></em>, <em class="manpage"><a class="manpage reference external" href="nsd-control.html">nsd-control(8)</a></em></p>
</section>
<section id="bugs">
<h2>Bugs<a class="headerlink" href="#bugs" title="この見出しへのパーマリンク">¶</a></h2>
<p><strong>nsd.conf</strong> is parsed by a primitive parser, error messages may not be to the
point.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nsd-checkzone.html" class="btn btn-neutral float-left" title="nsd-checkzone(8)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nsd-control.html" class="btn btn-neutral float-right" title="nsd-control(8)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2001–2024, NLnet Labs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>